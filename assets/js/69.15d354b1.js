(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{554:function(a,s,n){"use strict";n.r(s);var e=n(21),t=Object(e.a)({},(function(){var a=this,s=a.$createElement,n=a._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),n("p",[a._v("在上文Kubernetes入门篇中对kubernetes有一个初步的介绍，本文继续介绍kubernetes的核心组件Pod，当然还是以实际操作为主；另外说明一点的是本系列是本人的学习笔记。")]),a._v(" "),n("h2",{attrs:{id:"pod介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pod介绍"}},[a._v("#")]),a._v(" Pod介绍")]),a._v(" "),n("p",[a._v("Pod是Kubernetes中最为重要的核心概念，代表了Kubernetes中的基本构建模块；一个Pod可以包含一个容器或者多个容器，Pod本身是轻量级的，所以经常会创建很多Pod，紧密相关的容器进程经常放到同一个Pod中；一个Pod中的容器运行于相同的Network命名空间中，因此它们共享相同的IP地址和端口空间；Kubernetes集群中的所有Pod都在同一个共享网络地址空间中，每个Pod都可以通过其他Pod的IP地址来实现相互访问，就像局域网上的计算机一样。")]),a._v(" "),n("h3",{attrs:{id:"_1-创建pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建pod"}},[a._v("#")]),a._v(" 1.创建Pod")]),a._v(" "),n("p",[a._v("Pod和其他Kubernetes资源通常是通过向Kubernetes REST API提供JSON或YAML描述文件来创建的，当然还有如kubectl run类似的简单命令，只不过配置属性有限；")]),a._v(" "),n("h4",{attrs:{id:"_1-1-查询pod描述文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-查询pod描述文件"}},[a._v("#")]),a._v(" 1.1 查询Pod描述文件")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get po kubia-dms8n -o yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  ......\nspec:\n  ......\nstatus:\n  ......\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br")])]),n("p",[a._v("-o指定具体的格式，可以是yaml或者json格式；描述文件主要包括apiVersion，kind，metadata，spec以及status这几块：")]),a._v(" "),n("ul",[n("li",[a._v("apiVersion：Kubernetes API版本；")]),a._v(" "),n("li",[a._v("kind：Kubernetes对象资源类型；")]),a._v(" "),n("li",[a._v("metadata：包括名称、命名空间、标签和关于该容器的其他信息；")]),a._v(" "),n("li",[a._v("spec：包含pod内容的实际说明，例如pod的容器、卷和其他数据；")]),a._v(" "),n("li",[a._v("status：包含运行中的pod的当前信息，例如pod所处的条件、每个容器的描述和状态，以及内部IP和其他基本信息；")])]),a._v(" "),n("h4",{attrs:{id:"_1-2-创建yaml描述文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-创建yaml描述文件"}},[a._v("#")]),a._v(" 1.2 创建YAML描述文件")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata: \n   name: kubia-manual\nspec: \n   containers: \n   - image: ksfzhaohui/kubia\n     name: kubia\n     ports: \n     - containerPort: 8080\n       protocol: TCP\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br")])]),n("p",[a._v("kubia-manual为指定的pod的名称，ksfzhaohui/kubia使用的镜像，kubia为容器的名称，8080为应用监听的端口；这里的端口纯粹是展示性的，最终以容器中应用绑定的端口为准；")]),a._v(" "),n("h4",{attrs:{id:"_1-3-创建pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-创建pod"}},[a._v("#")]),a._v(" 1.3 创建pod")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("D:\\k8s>kubectl create -f kubia-manual.yaml\npod/kubia-manual created\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("以上创建了一个名称为kubia-manual的pod，可以查询当前的pod列表：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("D:\\k8s>kubectl get pods\nNAME           READY   STATUS    RESTARTS   AGE\nkubia-dms8n    1/1     Running   0          25h\nkubia-manual   1/1     Running   0          2m8s\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[a._v("kubia-manual已经准备就绪，当然也可以查询指定pod的描述文件(同1.1)；")]),a._v(" "),n("h4",{attrs:{id:"_1-4-查看应用日志"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-查看应用日志"}},[a._v("#")]),a._v(" 1.4 查看应用日志")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("D:\\k8s>kubectl logs kubia-manual -c kubia\nkubia server is starting...\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("以上表示查询Pod为kubia-manual中的容器kubia的日志（因为一个pod中可以包含多个容器），目前只有服务启动成功的日志，为了更好的观察日志变动，对容器中部署的应用发起请求，之前是通过穿件service来和pod进行通信，Kubernetes还提供了配置端口转发到pod的方式：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl port-forward kubia-manual 8888:8080\nForwarding from 127.0.0.1:8888 -> 8080\nForwarding from [::1]:8888 -> 8080\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("p",[a._v("然后在本地通过浏览器访问："),n("a",{attrs:{href:"http://localhost:8888/",target:"_blank",rel:"noopener noreferrer"}},[a._v("http://localhost:8888/"),n("OutboundLink")],1),a._v("；"),n("br"),a._v(" "),n("img",{attrs:{src:"https://oscimg.oschina.net/oscnet/up-e4025f18e3284c2e9150b424485782dbf41.png",alt:""}})]),a._v(" "),n("p",[a._v("继续观察容器中的日志，因为Pod中只有一个容器，所以这里可以不指定具体容器")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("C:\\Users\\hui.zhao.cfs>kubectl logs kubia-manual\nkubia server is starting...\nReceived request from ::ffff:127.0.0.1\nReceived request from ::ffff:127.0.0.1\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("h3",{attrs:{id:"_2-pod标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-pod标签"}},[a._v("#")]),a._v(" 2.Pod标签")]),a._v(" "),n("p",[a._v("标签是一种简单却功能强大的Kubernetes特性，不仅可以组织pod，也可以组织所有其他的Kubernetes资源；标签是可以附加到资源的任意键值对，用以选择具有该确切标签的资源；")]),a._v(" "),n("h4",{attrs:{id:"_2-1-创建pod指定标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-创建pod指定标签"}},[a._v("#")]),a._v(" 2.1 创建Pod指定标签")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("apiVersion: v1\nkind: Pod\nmetadata: \n   name: kubia-manual-v2\n   labels: \n     creation_method: manual\n     env: prod\nspec: \n   containers: \n   - image: ksfzhaohui/kubia\n     name: kubia\n     ports: \n     - containerPort: 8080\n       protocol: TCP\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br")])]),n("p",[a._v("在指定Pod名称kubia-manual-v2的下面指定了两个标签键值对，创建Pod：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("D:\\k8s>kubectl create -f kubia-manual-with-labels.yaml\npod/kubia-manual-v2 created\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("查询所有Pod，并显示标签：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get po --show-labels\nNAME              READY   STATUS    RESTARTS   AGE   LABELS\nkubia-dms8n       1/1     Running   0          26h   run=kubia\nkubia-manual      1/1     Running   0          49m   <none>\nkubia-manual-v2   1/1     Running   0          51s   creation_method=manual,env=prod\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("h4",{attrs:{id:"_2-2-修改pod标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-修改pod标签"}},[a._v("#")]),a._v(" 2.2 修改Pod标签")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl label po kubia-manual creation_method=manual\npod/kubia-manual labeled\n\n[d:\\k8s]$ kubectl get po -L creation_method,env\nNAME              READY   STATUS    RESTARTS   AGE   CREATION_METHOD   ENV\nkubia-dms8n       1/1     Running   0          26h                     \nkubia-manual      1/1     Running   0          55m   manual            \nkubia-manual-v2   1/1     Running   0          7m    manual            prod  \n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br")])]),n("p",[a._v("kubia-manual没有指定标签，可以进行添加，同时也可以修改：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl label po kubia-manual-v2 env=debug --overwrite\npod/kubia-manual-v2 labeled\n\n[d:\\k8s]$ kubectl get po -L creation_method,env\nNAME              READY   STATUS    RESTARTS   AGE     CREATION_METHOD   ENV\nkubia-dms8n       1/1     Running   0          26h                       \nkubia-manual      1/1     Running   0          57m     manual            \nkubia-manual-v2   1/1     Running   0          8m13s   manual            debug\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br")])]),n("p",[a._v("在更改现有标签时，需要使用--overwrite选项；")]),a._v(" "),n("h4",{attrs:{id:"_2-3-使用标签选择器列出pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-使用标签选择器列出pod"}},[a._v("#")]),a._v(" 2.3 使用标签选择器列出pod")]),a._v(" "),n("p",[a._v("标签选择器允许我们选择标记有特定标签的pod子集，并对这些pod执行操作；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get po -l creation_method=manual\nNAME              READY   STATUS    RESTARTS   AGE\nkubia-manual      1/1     Running   0          137m\nkubia-manual-v2   1/1     Running   0          88m\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[a._v("这里使用了creation_method=manual的标签选择器，这里可以是一个表达式，比如!=，in，notin等，多个条件用逗号分隔：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get po -l creation_method=manual,env=debug\nNAME              READY   STATUS    RESTARTS   AGE\nkubia-manual-v2   1/1     Running   0          98m\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("h4",{attrs:{id:"_2-4-使用标签和选择器来约束pod调度"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-使用标签和选择器来约束pod调度"}},[a._v("#")]),a._v(" 2.4 使用标签和选择器来约束pod调度")]),a._v(" "),n("p",[a._v("Kubernetes将集群中的所有节点抽象为一个整体的大型部署平台，所有pod都是近乎随机地调度到工作节点上；但是有时候我们希望调度到固定的硬件基础设施上，比如GPU加速，固态硬盘等等，Kubernetes也提供了相关的支持，通过标签和选择器来实现；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get nodes\nNAME       STATUS   ROLES    AGE   VERSION\nminikube   Ready    master   29h   v1.17.0\n\n[d:\\k8s]$ kubectl label node minikube gpu=true\nnode/minikube labeled\n\n[d:\\k8s]$ kubectl get nodes -l gpu=true\nNAME       STATUS   ROLES    AGE   VERSION\nminikube   Ready    master   29h   v1.17.0\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])]),n("p",[a._v("以上我们给默认的节点minikube添加一个gpu=true的标签来表示此工作节点是GPU加速节点；接下来需要给Pod指定节点选择器指定为gpu=true，这样就可以将Pod调度到特地的工作节点上；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('apiVersion: v1\nkind: Pod\nmetadata: \n   name: kubia-gpu\nspec: \n   nodeSelector:\n     gpu: "true"\n   containers: \n   - image: ksfzhaohui/kubia\n     name: kubia\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])]),n("p",[a._v("以上创建了YAML描述文件，指定了nodeSelector并且设置为gpu=true，创建Pod：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl create -f kubia-gpu.yaml\npod/kubia-gpu created\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br")])]),n("p",[a._v("然后查看Pod的详细信息，看对应的节点信息：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl get po kubia-gpu -o yaml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: kubia-gpu\nspec:\n  nodeName: minikube\n  nodeSelector:\n    gpu: "true"\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br")])]),n("p",[a._v("节点名称调度到了minikube，并且显示了节点选择器信息；")]),a._v(" "),n("h3",{attrs:{id:"_3-pod注解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-pod注解"}},[a._v("#")]),a._v(" 3.Pod注解")]),a._v(" "),n("p",[a._v("除标签外，pod和其他对象还可以包含庄解；注解也是键值对，与标签不同，注解并不是为了保存标识信息而存在的，它们不能像标签一样用千对对象进行分组，但是注解可以容纳更多的信息；可以给Pod添加和修改注解：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl annotate pod kubia-manual mycompany.com/someannotation="foo bar"\npod/kubia-manual annotated\n[d:\\k8s]$ kubectl describe pod kubia-manual\nName:         kubia-manual\nAnnotations:  mycompany.com/someannotation: foo bar\n......\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("h3",{attrs:{id:"_4-pod命名空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-pod命名空间"}},[a._v("#")]),a._v(" 4.Pod命名空间")]),a._v(" "),n("p",[a._v("标签和命令空间都可以用来组织成组的，Pod是可以有多个标签的，可以重叠；当时命名空间是不可用重叠的，将Pod分隔成完全独立的组，这样分组首先更加类型更加清晰，另外就是不同的命名空间可以使用相同的资源名称；")]),a._v(" "),n("h4",{attrs:{id:"_4-1-查找命名空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-查找命名空间"}},[a._v("#")]),a._v(" 4.1 查找命名空间")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get ns\nNAME                   STATUS   AGE\ndefault                Active   44h\nkube-node-lease        Active   44h\nkube-public            Active   44h\nkube-system            Active   44h\nkubernetes-dashboard   Active   44h\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("p",[a._v("通过如上命令发现命名空间，以上这些命名空间都是默认创建好的，我们创建的Pod都在default命令空间下，其他的都是系统自带的；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl get po --namespace default\nNAME              READY   STATUS    RESTARTS   AGE\nkubia-dms8n       1/1     Running   0          2d2h\nkubia-gpu         1/1     Running   0          30m\nkubia-manual      1/1     Running   0          25h\nkubia-manual-v2   1/1     Running   0          24h\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("p",[a._v("也可以通过查看指定命名空间对应的Pod列表；")]),a._v(" "),n("h4",{attrs:{id:"_4-2-创建命名空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-创建命名空间"}},[a._v("#")]),a._v(" 4.2 创建命名空间")]),a._v(" "),n("p",[a._v("命名空间是一种和其他资源一样的Kubernetes资源，因此可以通过将YAML文件提交到Kubernetes API服务器来创建该资源；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("apiVersion: v1\nkind: Namespace\nmetadata: \n  name: custom-namespace\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[a._v("kind指定为Namespace，表示正在定义一个命名空间，custom-namespace为命名空间的名字；")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl create -f custom-namespace.yaml\nnamespace/custom-namespace created\n[d:\\k8s]$ kubectl get ns\nNAME                   STATUS   AGE\ncustom-namespace       Active   4s\n......\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("p",[a._v("以上通过yaml描述文件创建命名空间；")]),a._v(" "),n("h4",{attrs:{id:"_4-3-指定命名空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-指定命名空间"}},[a._v("#")]),a._v(" 4.3 指定命名空间")]),a._v(" "),n("p",[a._v("可以在创建Pod的时候指定命名空间：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("[d:\\k8s]$ kubectl create -f kubia-manual.yaml -n custom-namespace\npod/kubia-manual created\n\n[d:\\k8s]$ kubectl get po --namespace default\nNAME              READY   STATUS    RESTARTS   AGE\nkubia-manual      1/1     Running   0          19h\n\n[d:\\k8s]$ kubectl get po --namespace custom-namespace\nNAME           READY   STATUS    RESTARTS   AGE\nkubia-manual   1/1     Running   0          2m19s\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])]),n("p",[a._v("可以看到在default和custom-namespace命名空间中存在相同名称的Pod，这就是命名空间的隔离功能；"),n("strong",[a._v("注：尽管命名空间将对象分隔到不同的组，只允许你对属于特定命名空间的对象进行操作， 但实际上命名空间之间并不提供对正在运行的对象的任何隔离。")])]),a._v(" "),n("h3",{attrs:{id:"_5-停止和移除pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-停止和移除pod"}},[a._v("#")]),a._v(" 5.停止和移除pod")]),a._v(" "),n("h4",{attrs:{id:"_5-1-按名称删除pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-按名称删除pod"}},[a._v("#")]),a._v(" 5.1 按名称删除pod")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl delete po kubia-gpu\npod "kubia-gpu" deleted\n[d:\\k8s]$ kubectl get po --namespace default\nNAME              READY   STATUS        RESTARTS   AGE\nkubia-gpu         1/1     Terminating   0          104m\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("p",[a._v("在删除pod的过程中，实际上我们在指示Kubernetes终止该pod中的所有容器，Kubernetes向进程发送一个SIGTERM信号并等待一定的秒数使其正常关闭；关闭的过程中可以发现Pod的状态为Terminating终结中；")]),a._v(" "),n("h4",{attrs:{id:"_5-2-使用标签选择器删除pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-使用标签选择器删除pod"}},[a._v("#")]),a._v(" 5.2 使用标签选择器删除pod")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl delete po -l creation_method=manual\npod "kubia-manual" deleted\npod "kubia-manual-v2" deleted\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br")])]),n("p",[a._v("会列出所有被删除的Pod；")]),a._v(" "),n("h4",{attrs:{id:"_5-3-通过删除整个命名空间来删除pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-通过删除整个命名空间来删除pod"}},[a._v("#")]),a._v(" 5.3 通过删除整个命名空间来删除pod")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl delete ns custom-namespace\nnamespace "custom-namespace" deleted\n\n[d:\\k8s]$ kubectl get po --namespace custom-namespace\nNo resources found in custom-namespace namespace.\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("p",[a._v("删除命名空间的同时，其中包含的Pod都会被删除；")]),a._v(" "),n("h4",{attrs:{id:"_5-4-删除所有pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-删除所有pod"}},[a._v("#")]),a._v(" 5.4 删除所有Pod")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl delete po --all\npod "kubia-dms8n" deleted\npod "kubia-gkv4v" deleted\npod "kubia-zxd9q" deleted\n\n[d:\\k8s]$ kubectl get po\nNAME          READY   STATUS    RESTARTS   AGE\nkubia-c9hlb   1/1     Running   0          46s\nkubia-f4kwr   1/1     Running   0          46s\nkubia-vttrc   1/1     Running   0          46s\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])]),n("p",[a._v("删除完所有Pod之后，又重新出现了三个Pod，主要原因是上面三个Pod是不是直接创建的，而是创建一个ReplicationController，然后再由ReplicationController创建pod；如果想要删除该pod需要删除ReplicationController，可以通过使用如下命令：")]),a._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v('[d:\\k8s]$ kubectl delete all --all\npod "kubia-c9hlb" deleted\npod "kubia-f4kwr" deleted\npod "kubia-vttrc" deleted\nreplicationcontroller "kubia" deleted\nservice "kubernetes" deleted\nservice "kubia" deleted\n\n[d:\\k8s]$ kubectl get po\nNo resources found in default namespace.\n')])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br")])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[a._v("#")]),a._v(" 总结")]),a._v(" "),n("p",[a._v("本文继续在阅读"),n("strong",[a._v("Kubernetes in Action")]),a._v("过程中，实际操作的笔记；主要介绍了Kubernetes的核心组件Pod，包括Pod的创建，标签，主键，命名空间以及停止和移除pod。")]),a._v(" "),n("h2",{attrs:{id:"参考"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),n("p",[a._v("Kubernetes in Action")])])}),[],!1,null,null,null);s.default=t.exports}}]);