(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{535:function(s,t,a){"use strict";a.r(t);var n=a(21),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("strong",[s._v("1.Mysql的连接方式")]),a("br"),s._v("\n要了解Mysql的通讯协议，首先需要知道是以哪种连接方式去连接Mysql服务器的；Mysql的主要连接方式包括：Unix套接字，内存共享，命名管道，TCP/IP套接字等。")]),s._v(" "),a("p",[s._v("1.1Unix套接字"),a("br"),s._v("\n在Linux和Unix环境下，可以使用Unix套接字进行Mysql服务器的连接；Unix套接字其实不是一个网络协议，只能在客户端和Mysql服务器在同一台电脑上才可以使用，使用方式也很简单：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root@root ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -proot")]),s._v("\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" show variables like "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'socket'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+---------------+---------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Value                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+---------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" socket        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" /var/lib/mysql/mysql.sock "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+---------------+---------------------------+\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" row "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("以上命令查询Unix套接字文件的位置；")]),s._v(" "),a("p",[s._v("1.2命名管道和内存共享"),a("br"),s._v("\n在window系统中客户端和Mysql服务器在同一台电脑上，可以使用命名管道和共享内存的方式，"),a("br"),s._v("\n命名管道开启：–enable-named-pipe=on/off;"),a("br"),s._v("\n共享内存开启：–shared-memory=on/off；")]),s._v(" "),a("p",[s._v("1.3TCP/IP套接字"),a("br"),s._v("\n在任何系统下都可以使用的方式，也是使用最多的连接方式，本文要介绍的通讯协议也是基于此连接方式的，下面通过tcpdump对TCP/IP套接字有一个初步的了解："),a("br"),s._v("\n服务器端：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@root ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcpdump port 3306")]),s._v("\ntcpdump: verbose output suppressed, use -v or -vv "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full protocol decode\nlistening on venet0, link-type LINUX_SLL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Linux cooked"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", capture size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(" bytes\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("服务器端监听3306端口(也就是Mysql的端口)；")]),s._v(" "),a("p",[s._v("客户端：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("C:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("hui.zhao"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("mysql -h64.xxx.xxx.xxx -uroot -proot\nmysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\nBye\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("客户端连接服务器，然后断开连接，这时候观察服务器的监听结果日志：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@root ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcpdump port 3306")]),s._v("\ntcpdump: verbose output suppressed, use -v or -vv "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" full protocol decode\nlistening on venet0, link-type LINUX_SLL "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Linux cooked"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", capture size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(" bytes\n \n02:06:25.442472 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27289263")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8192")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1460")]),s._v(",nop,wscale "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(",nop,nop,sackOK"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:25.442763 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("S."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2014324548")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("27289264")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14600")]),s._v(", options "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mss "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1460")]),s._v(",nop,nop,sackOK,nop,wscale "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:25.617449 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:29.812946 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":57, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\n02:06:29.992362 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":63, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("\n02:06:29.992411 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:29.992474 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(":68, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n02:06:30.166992 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("63")]),s._v(":100, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("\n02:06:30.167109 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("68")]),s._v(":158, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("\n02:06:30.536298 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:34.568611 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(":105, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n02:06:34.568620 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("F."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:34.568751 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("F."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("158")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("106")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n02:06:34.743815 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33876 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("159")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("[S]:SYN发起连接标志,[P]:PUSH传送数据标志,[F]:FIN关闭连接标志,[.]:表示确认包;"),a("br"),s._v("\n可以大致看出流程：建立tcp连接，客户端和Mysql服务器建立连接通讯，关闭tcp连接；"),a("br"),s._v("\n[S][S.][.]这几个数据包表示tcp连接的三次握手；"),a("br"),s._v("\n[F.][F.][.]这几个数据包表示tcp连接的四次挥手；"),a("br"),s._v("\n中间的多个[P.][.]其实就是客户端和Mysql服务器建立连接发送的协议数据包。")]),s._v(" "),a("p",[a("strong",[s._v("2.协议分析")]),a("br"),s._v("\nMysql协议被用在Mysql Clients和Mysql Server通讯的时候，具体有以下几个场景：客户端和服务器进行连接，Mysql代理以及主从备份；"),a("br"),s._v("\nMySQL客户端与服务器的交互主要分为两个阶段：Connection Phase（连接阶段或者叫认证阶段）和Command Phase（命令阶段）；"),a("br"),s._v("\n结合tcpdump的输出，客户端和服务器端通讯的整个流程大致如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".建立tcp连接三次握手；\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".与Mysql服务器建立连接，即Connection Phase（连接阶段或者叫认证阶段）；\n    s-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("c:发送握手初始化包（a Initial Handshake Packet）\n    c-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("s:发送验证包"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authentication response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    s-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("c:服务器发送认证结果包\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".认证通过之后，服务器端接受客户端的命令包，发送相应的响应包，即Command Phase（命令阶段）；\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".断开连接请求exit命令；\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".四次挥手tcp断开连接；\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("2.1基本类型"),a("br"),s._v("\n在整个协议中的基本类型：整数型和字符串型；")]),s._v(" "),a("p",[s._v("2.1.1整数型"),a("br"),s._v("\n分为两种类型Fixed-Length Integer Types和Length-Encoded Integer Type；"),a("br"),s._v("\nFixed-Length Integer Types："),a("br"),s._v("\n一个固定长度的无符号整数将其值存储在一系列字节中，具体固定字节数可以是：1，2，3，4，6，8；"),a("br"),s._v("\nLength-Encoded Integer Type："),a("br"),s._v("\n存储需要的字节数取决于数值的大小，具体可参照如下："),a("br"),s._v("\n1个字节：0<=X<251；"),a("br"),s._v("\n2个字节：251<=X<2^16；"),a("br"),s._v("\n3个字节：2^16<=X<2^24；"),a("br"),s._v("\n9个字节：2^24<=X<2^64；")]),s._v(" "),a("p",[s._v("2.1.2字符串型"),a("br"),s._v("\n分为5种类型包括，FixedLengthString，NullTerminatedString，VariableLengthString，LengthEncodedString和RestOfPacketString；"),a("br"),s._v("\nFixedLengthString：固定长度的字符串具有已知的硬编码长度，一个例子是ERR_Packet的SQL状态，它总是5个字节长；"),a("br"),s._v("\nNullTerminatedString：以遇到Null(字节为00)结束的字符串；"),a("br"),s._v("\nVariableLengthString：可变字符串，字符串的长度由另一个字段决定或在运行时计算，比如int+value，int为长度，value为指定长度的字节数；"),a("br"),s._v("\nLengthEncodedString：以描述字符串长度的长度编码的整数作为前缀的字符串，是VariableLengthString指定的int+value方式；"),a("br"),s._v("\nRestOfPacketString：如果一个字符串是数据包的最后一个组件，它的长度可以从整个数据包长度减去当前位置来计算；")]),s._v(" "),a("p",[s._v("2.2基本数据包"),a("br"),s._v("\n如果MySQL客户端或服务器想要发送数据，则："),a("br"),s._v("\n每个数据包大小不能超过2^24字节(16MB);"),a("br"),s._v("\n在每个数据块前面加上一个数据包头；")]),s._v(" "),a("p",[s._v("包格式如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：具体包内容的长度；除去"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("字节长度；\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：sequence_id随每个数据包递增，并可能环绕。 它从"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("开始，在命令阶段开始一个新的命令时重置为"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("；\nstring"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：具体数据内容，也是"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("指定的长度；\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("例如："),a("br"),s._v("\n01 00 00对应int表示具体数据内容的长度为1个字节；"),a("br"),s._v("\n00对应int表示sequence_id；"),a("br"),s._v("\n01对应string前面指定的数据内容为1个字节。")]),s._v(" "),a("p",[s._v("2.3报文类型"),a("br"),s._v("\n可以分成三个大类：登录认证报文，客户端请求报文以及服务器端返回报，基于mysql5.1.73(mysql4.1以后的版本)")]),s._v(" "),a("p",[s._v("2.3.1登录认证报文"),a("br"),s._v("\n主要在交互的认证阶段，由上文中可以知道一共分为三个阶段：Handshake Packet，authentication response以及结果包，这里主要分析前两个包；")]),s._v(" "),a("p",[s._v("2.3.1.1 Handshake Packet")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("字节：协议版本号\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NullTerminatedString")]),s._v("：数据库版本信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("字节：连接"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Server")]),s._v("启动的线程ID\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("字节：挑战随机数，用于数据库认证\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("字节：填充值"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("字节：用于与客户端协商通讯方式\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("字节：数据库的编码\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("字节：服务器状态\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("字节：预留字节\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("字节：挑战随机数，用于数据库认证\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("字节：填充值"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("使用tcpdump进行监听，输出十六进制日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@root ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tcpdump port 3306 -X")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n03:20:34.299521 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.44658: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":57, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\n    0x0000:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4508")]),s._v(" 0060 09f1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4006")]),s._v(" c666 43da "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9190")]),s._v("  E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("`"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("@.@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("fC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    0x0010:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9903")]),s._v(" fbca 0cea ae72 bb4e 25ba 21e7 27e3  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".r.N%."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(".'.\n    0x0020:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5018")]),s._v(" 0073 b1e0 0000 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3400")]),s._v(" 0000 0a35 2e31  P"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.1")]),s._v("\n    0x0030:  2e37 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3300")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4024")]),s._v(" 0000 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5157")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4222")]),s._v(" 252f 5f6f  .73.@$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v('QWB"%/_o\n    0x0040:  00ff f708 0200 0000 0000 0000 0000 0000  '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0050:  0000 0032 4a5d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7553")]),s._v(" 7e45 784f 627e "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7400")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".2J"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("uS~ExOb~t.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("包的总长度是56，减去int<3>+int<1>4字节=52字节，对应的十六进制就是34；int<3>十六进制为3400 00表示包内容长度，int<1>十六进制为00表示sequence_id；后续的内容就是包体内容共52字节，0a对应的十进制是10，所有协议号版本是10；后续的数据库版本信息遇到00结束，35 2e31 2e37 33对应的5.1.73，正是当前使用的数据库版本；4024 0000对应十进制是6436；08表示数据库的编码；0200表示服务器状态；后续的13对00为预留字节；最后的13个字节是挑战随机数和填充值。")]),s._v(" "),a("p",[s._v("2.3.1.2 Authentication Packet")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("字节：用于与客户端协商通讯方式\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("字节：客户端发送请求报文时所支持的最大消息长度值\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("字节：标识通讯过程中使用的字符编码\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("字节：保留字节\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NullTerminatedString")]),s._v("：用户名\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LengthEncodedString")]),s._v("：加密后的密码\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NullTerminatedString")]),s._v("：数据库名称（可选）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("使用tcpdump进行监听，输出十六进制日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("03:20:34.587416 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.44658 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":63, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("62")]),s._v("\n    0x0000:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4500")]),s._v(" 0066 29ee "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v(" 766b "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9903")]),s._v(" fbca  E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("f"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".@.p.vk"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0010:  43da "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9190")]),s._v(" ae72 0cea 21e7 27e3 bb4e 25f2  C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(".'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("N%.\n    0x0020:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5018")]),s._v(" 0100 d8d2 0000 3a00 0001 85a6 0f00  P"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    0x0030:  0000 0001 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2100")]),s._v(" 0000 0000 0000 0000 0000  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    0x0040:  0000 0000 0000 0000 0000 0000 726f 6f74  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("root\n    0x0050:  0014 ff58 4bd2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7946")]),s._v(" 91a0 a233 f2c1 28af  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".XK.yF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".\n    0x0060:  d578 0762 c2e8                           .x.b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("包的总长度是62，减去int<3>+int<1>4字节=58字节，对应的十六进制就是3a；int<3>十六进制为3a00 00表示包内容长度；int<1>十六进制为01表示sequence_id；726f 6f74 00是用户名解码后是root；后面是加密后的密码类型是LengthEncodedString，14对应的十进制是20，后面20个字节就是加密后的密码；可选的数据库名称不存在。")]),s._v(" "),a("p",[s._v("2.4客户端请求报文")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：执行的命令，比如切换数据库\nstring"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：命令相应的参数\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("命令列表：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),s._v("    COM_SLEEP   （内部线程状态"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x01")]),s._v("    COM_QUIT    关闭连接\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x02")]),s._v("    COM_INIT_DB 切换数据库\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x03")]),s._v("    COM_QUERY   SQL查询请求\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x04")]),s._v("    COM_FIELD_LIST  获取数据表字段信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x05")]),s._v("    COM_CREATE_DB   创建数据库\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x06")]),s._v("    COM_DROP_DB 删除数据库\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x07")]),s._v("    COM_REFRESH 清除缓存\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x08")]),s._v("    COM_SHUTDOWN    停止服务器\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x09")]),s._v("    COM_STATISTICS  获取服务器统计信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0A")]),s._v("    COM_PROCESS_INFO    获取当前连接的列表\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0B")]),s._v("    COM_CONNECT （内部线程状态"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0C")]),s._v("    COM_PROCESS_KILL    中断某个连接\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0D")]),s._v("    COM_DEBUG   保存服务器调试信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0E")]),s._v("    COM_PING    测试连通性\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x0F")]),s._v("    COM_TIME    （内部线程状态）\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x10")]),s._v("    COM_DELAYED_INSERT  （内部线程状态）\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x11")]),s._v("    COM_CHANGE_USER 重新登陆（不断连接）\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x12")]),s._v("    COM_BINLOG_DUMP 获取二进制日志信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x13")]),s._v("    COM_TABLE_DUMP  获取数据表结构信息\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x14")]),s._v("    COM_CONNECT_OUT （内部线程状态"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x15")]),s._v("    COM_REGISTER_SLAVE  从服务器向主服务器进行注册\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x16")]),s._v("    COM_STMT_PREPARE    预处理SQL语句\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x17")]),s._v("    COM_STMT_EXECUTE    执行预处理语句\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x18")]),s._v("    COM_STMT_SEND_LONG_DATA 发送BLOB类型的数据\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x19")]),s._v("    COM_STMT_CLOSE  销毁预处理语句\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1A")]),s._v("    COM_STMT_RESET  清除预处理语句参数缓存\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1B")]),s._v("    COM_SET_OPTION  设置语句选项\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x1C")]),s._v("    COM_STMT_FETCH  获取预处理语句的执行结果\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[s._v("比如：use test;使用tcpdump进行监听，输出十六进制日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":04:29.379165 IP "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33826 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" root.mysql: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("122")]),s._v(":131, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64019")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n    0x0000:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4500")]),s._v(" 0031 3f19 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7006")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6175")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9903")]),s._v(" fbca  E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("?.@.p.au"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0010:  43da "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9190")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8422")]),s._v(" 0cea 42e2 524b 7e18 25c1  C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("B.RK~.%.\n    0x0020:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5018")]),s._v(" fa13 a07b 0000 0500 0000 0274 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6573")]),s._v("  P"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".tes\n    0x0030:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v("                                       t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("包的总长度是9，减去int<3>+int<1>4字节=5字节，对应的十六进制就是05；int<3>十六进制为0500 00表示包内容长度；int<1>十六进制为00表示sequence_id；02对应COM_INIT_DB，后面是test的二进制编码；")]),s._v(" "),a("p",[s._v("2.5服务器响应报文"),a("br"),s._v("\n对于客户端发送给服务器的大多数命令，服务器返回其中一个响应的数据包：OK_Packet，ERR_Packet和EOF_Packet，Result Set；")]),s._v(" "),a("p",[s._v("2.5.1OK_Packet"),a("br"),s._v("\n表示成功完成一个命令，具体格式如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("："),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0x00")]),s._v("或"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("xFEOK包头\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("lenenc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：受影响行数\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("lenenc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：最后插入的索引ID\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：服务器状态\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：告警计数  注："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 及之后的版本才有\nstring"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("lenenc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：服务器消息"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可选"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("use test;服务器返回的包，使用tcpdump进行监听，输出十六进制日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":04:29.379308 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.33826: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(":233, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14600")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n    0x0000:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4508")]),s._v(" 0033 4a0a "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4006")]),s._v(" 867a 43da "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9190")]),s._v("  E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("3J.@.@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("zC"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    0x0010:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9903")]),s._v(" fbca 0cea "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8422")]),s._v(" 7e18 25c1 42e2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5254")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v('."~.%.B.RT\n    0x0020:  '),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5018")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3908")]),s._v(" 3b61 0000 0700 0001 0000 0002  P.9."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0030:  0000 00                       \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("包的总长度是11，减去int<3>+int<1>4字节=7字节，对应的十六进制就是07；int<3>十六进制为0700 00表示包内容长度；int<1>十六进制为01表示sequence_id；00表示包头；00表示受影响行数；00表示最后插入的索引ID；0200表示服务器状态；")]),s._v(" "),a("p",[s._v("2.5.2ERR_Packet"),a("br"),s._v("\n表示发生了错误，具体格式如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("："),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xFF")]),s._v(" ERR包头\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：错误码\nstring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sql")]),s._v("状态标识   注："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 及之后的版本才有\nstring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Sql")]),s._v("状态       注："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 及之后的版本才有\nstring"),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("EOF"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：错误消息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("2.5.3EOF_Packet"),a("br"),s._v("\n以标记查询执行结果的结束：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：EOF值（"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xFE")]),s._v("）\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：告警计数    注："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 及之后的版本才有\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("：状态标志位   注："),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySQL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 及之后的版本才有\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("2.5.4Result Set"),a("br"),s._v("\n当客户端发送查询请求后，在没有错误的情况下，服务器会返回结果集（Result Set）给客户端，一共有5个部分：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Result Set Header       返回数据的列数量\nField                   返回数据的列信息（多个）\nEOF                     列结束\nRow Data                行数据（多个）\nEOF                     数据结束\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("2.5.4.1Result Set Header")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Length-Encoded Integer  Field结构的数量\nLength-Encoded Integer  额外信息\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("2.5.4.2Field")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("LengthEncodedString     目录名称\nLengthEncodedString     数据库名称\nLengthEncodedString     数据表名称\nLengthEncodedString     数据表原始名称\nLengthEncodedString     列（字段）名称\nLengthEncodedString     列（字段）原始名称\nint<1>                  填充值\nint<2>                  字符编码\nint<4>                  列（字段）长度\nint<1>                  列（字段）类型\nint<2>                  列（字段）标志\nint<1>                  整型值精度\nint<2>                  填充值（0x00）\nLengthEncodedString     默认值\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("2.5.4.3EOF"),a("br"),s._v("\n参考2.5.3EOF_Packet")]),s._v(" "),a("p",[s._v("2.5.4.4Row Data")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("LengthEncodedString     字段值\n......                  多个字段值\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("实例分析，表信息如下：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("btest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("bigint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("varchar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token identifier"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("InnoDB")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AUTO_INCREMENT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DEFAULT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CHARSET")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("select * from btest;服务器返回的数据如下：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("mysql"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" btest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" age  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------+")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" zhaohui "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" zhaohui "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------+")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("服务器返回的包，使用tcpdump进行监听，输出十六进制日志如下：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("01:54:21.522660 IP root.mysql "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("153.3")]),s._v(".251.202.58587: Flags "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("P."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":196, ack "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(", win "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v(", length "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("195")]),s._v("\n    0x0000:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4508")]),s._v(" 00eb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8839")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4000")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4006")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4793")]),s._v(" 43da "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9190")]),s._v("  E"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("@.@.G.C"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    0x0010:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9903")]),s._v(" fbca 0cea e4db 9dd8 0216 eda6 f730  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".0\n    0x0020:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5018")]),s._v(" 0073 ca34 0000 0100 0001 0328 0000  P"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("s.4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0030:  0203 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6604")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("def.test.btest\n    0x0040:  0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0269 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6402")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6964")]),s._v(" 0c3f 0014  .btest.id.id.?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0050:  0000 0008 0342 0000 002a 0000 0303 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6465")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".*"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("de\n    0x0060:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6604")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v("  f.test.btest.bte\n    0x0070:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0361 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6765")]),s._v(" 0361 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6765")]),s._v(" 0c3f 000b 0000  st.age.age.?"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x0080:  0003 0000 0000 002c 0000 0403 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6604")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("def.\n    0x0090:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v(" 0562 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7465")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7374")]),s._v("  test.btest.btest\n    0x00a0:  046e 616d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6504")]),s._v(" 6e61 6d65 0c21 00fd 0200  .name.name."),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    0x00b0:  00fd 0000 0000 0005 0000 05fe 0000 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2200")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('".\n    0x00c0:  0d00 0006 0131 0231 3007 7a68 616f 6875  .....1.10.zhaohu\n    0x00d0:  690d 0000 0701 3202 3131 077a 6861 6f68  i.....2.11.zhaoh\n    0x00e0:  7569 0500 0008 fe00 0022 00              ui......."')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("0328 0000 02对应的是Result Set Header，03表示3个字段；03 6465 66对应的是目录名称的默认值def，03表示后面的字节数为3；04 7465 7374"),a("br"),s._v("\n对应的是数据库名称test；0562 7465 7374对应的是数据表名称btest；0562 7465 7374对应的是数据表原始名称btest；0269 64对应字段名称id；02 6964对应列（字段）原始名称id；0c3f 00对应的是填充值和字符编码；14 0000 00对应的十进制是20表示列（字段）长度；08 0342 00分别表示列（字段）类型，标识，整型值精度；00002个字节为填充值；00为默认值表示空的；"),a("br"),s._v("\n后续的age和name字段同上，不在重复；")]),s._v(" "),a("p",[s._v("0131类型LengthEncodedString对应的字符1就是id的值；0231 30类型LengthEncodedString对应的字符10就是age的值；07 7a68 616f 6875 69类型LengthEncodedString对应的字符zhaohui就是name的值；")])])}),[],!1,null,null,null);t.default=e.exports}}]);